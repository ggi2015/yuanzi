# 代码整洁之道

## 

## 有意义的命名 
- 名副其实  
    变量：指明**计量对象**和**计量单位**的名称；  
    选择体现本意的名称，能让人更容易理解和修改代码；  
    问题不在于代码的简介度，而在于代码的模糊度：即上下文在代码中未被明确体现的程度。  

- 避免误导  

- 做有意义的区分  
    以数字系列命名（a1，a2，...，aN）是依义命名的对立面。纯属误导。
    Product类，ProductInfo类，ProductData类，名称虽然不同，意思却无区别。Info与Data就像a，an和the一样，是意义含混的废话。  
    废话都是冗余。Variable一词永远不要出现在变量名中；Table一词永远不要出现在表名中；  
    要区分名称，就要以读者能鉴别不同之处的方式来区分。  

- 使用读得出来的名字  

- 使用可搜索的名称  
    找MAX_CLASSES_PER_SYUDENT更容易，但找数字7就麻烦了。长名称胜于短名称，搜得到的名称胜于用于自造编码代写就的名称。  
    单字母名仅用于短方法中的本地变量。名称长短应与其作用域大小相应。若变量或常量可能在多出代码中使用，应赋予其便于搜索的名称。  

- 避免使用编码  
    匈牙利语标记法
    成员前缀：  
        应当使用某种可以高亮或用颜色标出成员的编辑环境。  
    接口和实现[TODO]  

## 避免思维映射  
    不应当让读者在脑中把你的名称翻译为他们熟知的名称。  
    如单字母变量名，在作用域小、无名称冲突时，循环计数器可以被命名为i、j、k。  
    明确是王道，编写别人能理解的代码。  

## 类名
    类名不应当是动词。  
    类名和对象名应该是名词或名词短语，避免使用Manager、Processor、Data或Info这样的类名。  

## 方法名  
    方法名应当是动词或动词短语。  
    属性访问器、修改器和断言应该根据其值命名，并加上get、set和is前缀。  
    重载构造器时，使用描述了参数的静态工厂方法名。可以考虑将相应的构造器设置为private，强制使用这种命名手段[TODO]  

## 每个概念对应一个词
    给每个概念对应选一个词，并一以贯之。如，使用fetch、retrieve和get这类词，选一个就行；controller、manager和driver这类词，混杂用，就容易令人迷惑。

## 别用双关语  

## 使用解决方案领域名称

## 使用源自所涉问题领域的名称  
    如果不能用程序要熟悉的术语来给手头工作命名，就采用所涉问题领域而来的名称。  

## 添加有意义的语境   
    需要有良好命名的类、函数或名称空间来放置名称，给读者提供语境。如果没这么作，给名称添加前缀就是最后一招。  
    假如，有变量firstName、lastName、street、houseNumber、city、state和zipcode等变量，和在一起之道构成地址，但是单独一个state变量，无法知道；可以添加前缀addrFirstName、addrLastName、addrState等以提供语境。更好的方案是创建Address的类，这样即使编译器也知道这些变量属于更大的概念。 

## 避免无意义的语境  


## 函数  

### 短小  
经过漫长的试错，经验告诉我，函数就该小。每行都不该有150个字符那么长，函数也不该有100行那么长，20行封顶最佳。
if、else、while语句等，其中的代码应该只有一行，大抵是个函数调用。  
函数的缩进层级不应多于一层或两层。  

### 只做一件事  
函数应该做一件事。做好这件事。只做这一件事。  

### 每个函数一个抽象层级  
要确保函数只做一件事，函数中的语句都要在同一抽象层级上。  
自顶向下读代码：向下规则  
    想要让每个函数后面都跟着位于下一抽象层级的的函数，这样一来，在查看函数列表时，就能循抽象层级往下阅读了。
    另一种说法：程序就像是一系列def起头的段落，每一段都描述当前抽象层级，并引用位于下一抽象层级的后续def起头段落。  

### SWITCH 语句  
确保每个switch都埋藏在较低的抽象层级，而且永不重复。利用多态来实现这一点。
[TODO]

### 使用描述性名称  
长而具有描述性的名称，比描述性的长注释好。使用某种命名约定，让函数名称中的多个单词容易阅读，然后用这些单词给函数取个能够说清其功能的名称。  
命名方式要保持一致，使用于模块名一脉相承的短语、名词和动词给函数命名。

### 函数参数  
最理想的参数数量是零，其次是一，再次是二，应尽量避免三。有足够理由才能用三个及以上参数（多参数函数）。   
- 一元函数的普遍形式
    向函数传入单个参数的两种理由：问关于该参数的问题；或者操作该参数，将其转化为其他东西，再输出。  
    另一种不普遍但有用的单参数函数形式，事件(event)，有输入参数，无输出参数。程序将函数看作一个事件 ，使用该参数修改系统状态。要小心使用这种形式，让读者清楚了解这是事件，谨慎选用名称和上下文语境。  
    尽量避免编写不遵循这些形式的一元函数。  
- 标识参数  
    传入标示参数，即意味着该函数不止做一件事。
- 二元函数  
    尽量利用一些机制将其转换为一元函数。  
    如，把writeFile方法写成outputStream的成员之一，从而：outputStream.wirteFile(name)；或则把outputStream写成当前类的成员变量，从而无需再传递它；或者分离出FieldWriter的新类，在其构造器中采用outputStream，并包含一个write方法。  
- 三元函数  
    写三元函数之前，一定要想清楚。  
- 对象参数  
    如果函数看来需要两个、三个或者三个以上参数，就说明其中一些参数应该封装为类了。  
- 参数列表  
    当想要向函数传入数量可变的参数。  
- 动词与关键字  
    给函数取好名字，以解释函数意图及参数顺序和意图。
    一元函数：函数和参数应当形成一种良好的**动词/名词对**形式，如writeField(name):告诉我们name是一个Field。  
    函数名称的关键字形式，把参数的名称编码成函数名，如assertEqual改成assertExpecteedEqualsActual(expected, actual)。  

### 无副作用  
    时序性耦合，就应该体现在函数名称中说明。
    输出参数：普遍而言，应避免使用输出参数，如果函数必须要改变某种参数状态，就修改所属对象的状态巴。

### 分隔指令与询问  
    函数要做什么事，要回答什么事情，但二者不可得兼。函数应该修改某对象的状态，或是返回该状态的有关信息。  

### 使用异常替代返回错误码  
    返回错误码，就是在要求调用者立刻处理错误。  
    但，如果用异常替代返回错误码，错误处理代码就能从主路径代码中分离出来，得到简化。  
  - 抽离Try/Catch代码  
    Try/Catch代码块丑陋不堪，搞乱了代码结构，把错误处理与正常流程混为一谈。最好把try和catch代码块的主体部分抽离出来，另外形成函数。  
  - 错误处理就是一件事  
    处理错误的代码不该做其他事，只该有Try/Catch代码块，后面不该有其他东西。  
  - 异常派生
    使用异常替代错误码，新异常可以从异常类中派生出来，无须重新编译或部署。  

### 别重复自己  

### 结构化编程  
    只要保持函数短小，偶尔出现return、break或continue语句没有坏处，甚至比单出原则更有表现力。goto只在大函数中才有道理，尽量避免使用。  

### 代码需要反复打磨，分解函数，修改名称、消除重复；缩短和重新安置方法，或拆散类，以保持测试通过。最后按照上述规则，组装函数。  
    每人能一开始就按照规则写函数。  


## 注释
程序员不能坚持维护注释！！  

### 注释不能美化糟糕的代码  
与其花时间编写解释你搞出的糟糕的代码的注释，不如花时间清洁你那堆糟糕的代码。  

### 用代码来阐述

### 好注释  
- 法律信息  
- 提供信息的注释  
注释来提供基本信息； 如，注释解释某个抽象方法的返回值； 
- 对意图的解释  
注释不仅提供有关实现的有用信息，还提供了某个决定后面的意图
- 阐释
注释把某些晦涩难明的参数或返回值的意义翻译为某种可读的形式；  
最好是参数或返回值本身就足够清楚，但是参数或返回值是某个标准库的一部分，或是你不能修改的代码，帮助阐释其含义的代码就会有用。  
- 警示
用于警告其他程序员会出现某种后果的注释也是有用的。
- TODO
- 放大
注释用于放大某种看来不合理之物的重要性。  

### 坏注释  
- 喃喃自语
- 多于的注释
- 误导性注释
- 循规式注释
- 日志式注释
冗长的记录只会让记录变得凌乱不堪，应当全部删除。  
- 废话注释
- 可怕的废话
- 能用函数或变量时就别用注释
- 位置标记
- 归属与署名
源代码控制系统是归属与署名信息最好的归属地。
- 注释掉的代码
直接把代码注释掉是讨厌的做法，别这么做！！  
源代码控制系统能够为我们记住不要的代码，无须再用注释来标记，直接删除即可。
- HTML注释  
- 非本地信息
如果一定要写注释，请确保它描述了离他最近的代码，别在本地注释的上下文环境中给出系统级信息。  
- 信息过多  
- 不明显的联系
代码与描述的注释间的联系需要显而易见。  
- 函数头  
把函数名取好就行。  
- 范例  

## 格式 
团队采用一致同意的一套简单格式规则，贯彻规则。  

### 垂直格式  
- 向报纸学习
源文件顶部给出最高层次概念和算法，细节应往下逐次展开，知道源文件最底层的函数和细节。
- 概念间，垂直方向上的区隔
几乎所有的代码都是从上往下读，从左往右读。
每行展现一个表达式或一个子句，每组代码行展示一条完整的思路。这些思路用空白行区隔开来。  
- 垂直方向上的靠近  
相关的代码都该放在一起
- 垂直距离 
变量声明：应尽可能靠近其使用位置；函数很短，本地变量应该在函数顶部出现；较长的函数，变量也可以在某个代码块顶部。
循环中控制变量应该总是在循环语句中声明。
实体变量：应该在类的顶部声明；在c++中，剪刀原则：所有实体变量放在底部。
相关函数：若某个函数调用类另外一个，就应该把他们放在一起，且调用者应该尽可能在被调用者上面。
概念相关：概念相关的代码应该放在一起，相关性越强，彼此间距离越短。
- 垂直顺序
自上而下展示函数调用依赖顺序，即被调用的函数放在调用函数下面。建立自顶向下贯穿源代码模块的良好信息流。

### 横向格式  
应尽量保持代码行短小。通常80个字符，最多100到120个字符，不能再多了。
- 水平方向区隔与靠近
`=`周围加空格，以此强调。赋值有两个要素：左值、右值，空格以加强分隔。
不在函数名和左圆括号之间加空格，因为函数与其参数密切相关；把函数调用括号中的参数一一隔开，强调逗号，逗号后空格，表参数互相分离。
此外，乘法因子间无空格，因为较高优先级；加减法空格隔开，优先级低。
- 水平对齐  
- 缩进
文件顶层的语句，如大多数类声明，不缩进；
类中方法相对于该类，缩进一个层级；
方法的实现相对于方法声明，缩进一个层级；
代码块的实现相对于其容器代码块缩进一个层级。
左大括号在一行末；右大括号在一行首，有缩进格式。

- 空范围
如`while`的内容为空，分号需要单独一行，否则容易忽略；  

### 团队规则
什么地方放括号，缩进几个字符，如何命名类、变量、方法等。

## 对象和数据结构

